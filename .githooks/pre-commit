#!/usr/bin/env bash

# Pre-commit git hook that enforces strict error handling
# - set -e: Exit immediately if any command exits with a non-zero status
# - set -u: Exit if an undefined variable is referenced
# - set -o pipefail: Exit if any command in a pipeline fails
set -euo pipefail

echo "▶ cargo fmt --check"
if ! cargo fmt -- --check; then
  echo "❌ Formatting issues found. Run 'cargo fmt' then re-stage your changes."
  exit 1
fi

echo "▶ cargo build"
if ! cargo build; then
  echo "❌ Build failed."
  exit 1
fi

echo "▶ cargo test"
if ! cargo test; then
  echo "❌ Tests failed."
  exit 1
fi

echo "✅ All checks passed."
